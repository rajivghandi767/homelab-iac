groups:
  - name: container_health
    rules:
      # 1. Service Down (Critical)
      - alert: ServiceDown
        expr: up == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Service {{ $labels.instance }} is DOWN"
          description: "Service has been unreachable for > 1 minute."

      # 2. Container Restarted (Warning)
      # Uses cAdvisor metrics to detect if a container started < 2 mins ago
      - alert: ContainerRestarted
        expr: time() - container_start_time_seconds{name!=""} < 120
        for: 0m
        labels:
          severity: warning
        annotations:
          summary: "Container {{ $labels.name }} just restarted"
          description: "Container uptime is less than 2 minutes. Check logs for potential crash loops."

      # 3. High Memory Usage (Warning)
      # Alert if memory usage > 85%
      - alert: HighMemoryUsage
        expr: container_memory_usage_bytes{name!=""} / container_spec_memory_limit_bytes > 0.85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High Memory: {{ $labels.name }}"
          description: "Memory usage is above 85%."